var cCookie=function(e,t,r){if(typeof t!="undefined"){r=r||{};if(t===null){t="";r.expires=-1}var i="";if(r.expires&&(typeof r.expires=="number"||r.expires.toUTCString)){var s;if(typeof r.expires=="number"){s=new Date;s.setTime(s.getTime()+r.expires*24*60*60*1e3)}else{s=r.expires}i="; expires="+s.toUTCString()}var n=r.path?"; path="+r.path:"";var a=r.domain?"; domain="+r.domain:"";var o=r.secure?"; secure":"";document.cookie=[e,"=",encodeURIComponent(t),i,n,a,o].join("")}else{var u=null;if(document.cookie&&document.cookie!=""){var c=document.cookie.split(";");for(var p=0;p<c.length;p++){var f=jQuery.trim(c[p]);if(f.substring(0,e.length+1)==e+"="){u=decodeURIComponent(f.substring(e.length+1));break}}}return u}};var cAjax=function(e){return $.ajax({dataType:e["dataType"]?e["dataType"]:"JSON",url:e["url"],type:e["type"]?e["type"]:"GET",data:e["data"],retryCount:e["retryCount"]?e["retryCount"]:0,retryLimit:10,success:function(t){if(typeof e["success"]=="function"){e["success"](t)}},error:function(t){if(t.status>500&&this.retryCount<this.retryLimit){e["retryCount"]=e["retryCount"]?e["retryCount"]+1:1;setTimeout(function(){cAjax(e)},2e3)}else{if(typeof e["error"]=="function"){e["error"](t)}}}})};var cacheClass=function(){var e=[];function t(e,t,r,i){return new cache(e,t,r,i)}return{getGlobalCache:function(e,t){return this.getInstance("1",e,t,true)},getInstance:function(r,i,s,n){var a=i;if(n&&n===true){a+="global"}else{a+=r}if(!e[a]){e[a]=t(r,i,s,n)}return e[a]}}}();var cache=function(e,t,r,i){var s=window.localStorage;var n=CryptoJS.MD5(window.location.href.split("?")[0]);var a=e;if(i&&i===true){a="global"}var o=n+":"+a+":"+t+":";if(s){return{global:i,storage:s,cid:e,userkey:r,set:function(e,t,r){var i=(new Date).getTime()/1e3;r=r=="undefined"?0:r;if(!Ember.isEmpty(t)){t={ttl:r,value:t,timestamp:i};t=JSON.stringify(t);t=CryptoJS.AES.encrypt(t,this.userkey);this.storage.setItem(o+e,t)}},update:function(e,t,r){var i=this.storage.getItem(o+e);if(i&&i.length>0){var s=CryptoJS.AES.decrypt(i,this.userkey).toString(CryptoJS.enc.Utf8);s=JSON.parse(s);var n=s.timestamp;if(!Ember.isEmpty(t)){t={ttl:r,value:t,timestamp:n};t=JSON.stringify(t);t=CryptoJS.AES.encrypt(t,this.userkey);this.remove(e);this.storage.setItem(o+e,t)}}else{this.set(e,t,r)}},get:function(e){try{var t=(new Date).getTime()/1e3;var r=this.storage.getItem(o+e);if(r&&r.length>0){var i=CryptoJS.AES.decrypt(r,this.userkey).toString(CryptoJS.enc.Utf8);i=JSON.parse(i);if(i.ttl==0||t-i.timestamp<=i.ttl){return i.value}else{this.remove(e)}}}catch(s){}return""},has:function(e){return this.get(e)?true:false},remove:function(e){var t=this.storage.getItem(o+e);if(t&&t.length>0){s.removeItem(o+e)}}}}else{return{global:i,storage:{},cid:e,userkey:r,uniqueCacheWrapperId:o,set:function(e,t,r){var i=(new Date).getTime()/1e3;r=r=="undefined"?0:r;if(!Ember.isEmpty(t)){t={ttl:r,value:t,timestamp:i};t=JSON.stringify(t);t=CryptoJS.AES.encrypt(t,this.userkey).toString(CryptoJS.enc.Utf8);this.storage[this.uniqueCacheWrapperId+e]=t}},update:function(e,t,r){var i=this.storage[o+e];if(this.storage.hasOwnProperty(this.uniqueCacheWrapperId+e)){var s=CryptoJS.AES.decrypt(i,this.userkey).toString(CryptoJS.enc.Utf8);s=JSON.parse(s);var n=s.timestamp;if(!Ember.isEmpty(t)){t={ttl:r,value:t,timestamp:n};t=JSON.stringify(t);t=CryptoJS.AES.encrypt(t,this.userkey);this.remove(e);this.storage[o+e]=t}}else{this.set(e,t,r)}},get:function(e){var t=(new Date).getTime()/1e3;if(this.storage.hasOwnProperty(this.uniqueCacheWrapperId+e)){var r=this.storage[this.uniqueCacheWrapperId+e];var i=CryptoJS.AES.decrypt(r,this.userkey).toString(CryptoJS.enc.Utf8);if(i.ttl==0||t-i.timestamp<=i.ttl){return this.storage[this.uniqueCacheWrapperId+e]}else{this.remove(e)}}return""},has:function(e){return this.get(e)?true:false},remove:function(e){if(this.storage.hasOwnProperty(this.uniqueCacheWrapperId+e)){delete this.storage[this.uniqueCacheWrapperId+e]}}}}};var clearUserCache=function(){cAjax({url:"/api/user/key",success:function(e){var t=e.key;var r=cacheClass.getGlobalCache("user",t);r.remove("user")}})};var getUserKey=function(){return new Promise(function(e,t){var r=cCookie("userkey");var i=function(){cAjax({url:"/api/user/key",success:function(t){cCookie("userkey",t.key,{expires:6e-4,path:"/"});e(t.key)},error:function(e){t(e)}})};if(r){e(r)}else{i()}})};