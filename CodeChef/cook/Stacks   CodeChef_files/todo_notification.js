$(document).ready(function(){setupTodos(true)});var todosCache={};function setupTodos(t){var o=$(".notification-listbox");$(".notification-box-todo>#todo-notification-icon, .notification-box-todo>.notification-counter").click(function(t){if(o.is(":hidden")){o.show();show_todo_notification(o)}else{hide_todo_notification(o)}t.preventDefault()});$(document).keyup(function(t){if(t.keyCode==27){hide_todo_notification(o)}});updateNotifCounter(t);setTimeout(function(){updateNotifCounter()},5e3)}function show_todo_notification(t){if($(".notification-listbox-head").length>0){$(".notification-listbox-head").after('<div class="notification-listbox-loader"></div>')}setTimeout(function(){$.ajax({url:"/todo/notification",type:"GET",dataType:"json",success:function(o){var e=o.count;t.empty().html(o.html);if(e>0){$(".notification-counter").text(e)}},error:function(o,e,n){t.empty().append("Sorry your Todo list can not be rendered.")}})},1e3)}function hide_todo_notification(t){t.hide()}function widget_add_todo(t,o,e){var n=t.target;$.ajax({type:"POST",url:"/api/todo/add",dataType:"json",data:{pcode:o,ccode:e}}).done(function(t){if(typeof $.growl==="function"){$.growl({title:"Success",message:t.message})}else{$($(n).next(".todo-button-message")[0]).html(t.message)}$(n).prop("src","/sites/all/themes/abessive/images/add2.png");$(n).prop("title","Problem already present in Todo list");incrementNotifCouter()}).fail(function(t){var o=JSON.parse(t.responseText);if(typeof $.growl==="function"){$.growl({title:"Error",message:o.message})}else{$($(n).next(".todo-button-message")[0]).html(o.message)}})}function updateNotifCounter(t){var o=function(t){todosCache.result=t;var o=t.todoCount;$(".notification-counter").text(o)};var e=function(t){if(t.status==403){todosCache.result={};todosCache.result.todoCount=0}};if(t||!todosCache.hasOwnProperty("result")){$.ajax({url:"/todo/notification/count",type:"GET",dataType:"json",crossDomain:true,success:o,error:e})}else{o(todosCache.result)}}function incrementNotifCouter(){var t=$(".notification-counter").html();if(t===""){$(".notification-counter").html(1);todosCache.result={};todosCache.result.count=1}else{$(".notification-counter").html(parseInt(t)+1);todosCache.result.count++}}function decrementNotifCouter(){var t=$(".notification-counter").html();$(".notification-counter").html(parseInt(t)-1)}function setNotifCounter(t){$(".notification-counter").html(parseInt(t))}